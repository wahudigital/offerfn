<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Wahu Admin - Orders</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:18px;background:#f6f8fb}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border:1px solid #e3e8ef;text-align:left}
    th{background:#eef3fb}
    pre{white-space:pre-wrap;background:#fff;padding:12px;border-radius:6px;border:1px solid #e8eef7}
    button{padding:6px 12px;border:none;background:#4a7cff;color:white;border-radius:4px;cursor:pointer}
    button:hover{background:#355fcc}
  </style>
</head>
<body>
  <h2>Orders</h2>
  <table id="orders">
    <thead>
      <tr>
        <th>ID</th><th>YouTube User</th><th>Youtube Email</th><th>Title</th><th>Type</th>
        <th>Email</th><th>Phone no.</th><th>Created</th><th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="detail" style="margin-top:18px"></div>

<script>
  // ðŸ‘‡ replace with your actual backend username/password
  const AUTH = 'Basic ' + btoa('admin:Password123');  // must match server.js credentials

  // Load orders list
  async function load(){
    const res = await fetch('https://offer-n91a.onrender.com/admin/orders', {
      headers: { 'Authorization': AUTH }
    });
    if (!res.ok) {
      document.body.innerHTML = '<p>Failed to load orders. Wrong username or password.</p>';
      return;
    }
    const rows = await res.json();
    const tbody = document.querySelector('#orders tbody');
    tbody.innerHTML = '';

    rows.forEach(row => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${row.id}</td>
        <td>${row.yt_user || ''}</td>
        <td>${row.yt_email || ''}</td>
        <td>${row.site_title || ''}</td>
        <td>${row.site_type || ''}</td>
        <td>${row.email || ''}</td>
        <td>${row.assets || ''}</td>
        <td>${row.created_at}</td>
        <td><button onclick="view(${row.id})">View</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  // Load order detail
  async function view(id){
    const res = await fetch('https://offer-n91a.onrender.com/admin/orders/' + id, {
      headers: { 'Authorization': AUTH }
    });
    if (!res.ok) {
      document.getElementById('detail').innerHTML = '<p>Failed to load order.</p>';
      return;
    }
    const row = await res.json();  
    document.getElementById('detail').innerHTML = `
  <h3>Order #${row.id}</h3>
  <pre>${JSON.stringify(row, null, 2)}</pre>
  ${row.proof_path ? `
    <p>
      <a href="${row.proof_path}" target="_blank">Open Proof Link</a>
    </p>
    <p>
      <img src="${row.proof_path}" alt="Proof Image" style="max-width:400px;border:1px solid #ccc;border-radius:6px;margin-top:8px;">
    </p>
  ` : ''}
`;
  }


  load();
</script>
</body>
</html>
